<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Presentaciones Gaby - Acceso P√∫blico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .title-font {
            font-family: 'Fredoka', sans-serif;
        }
        .presentation-card {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .presentation-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.2), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
        }
        .modal-backdrop {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.8);
        }
        .modal-content {
            max-height: 95vh;
            overflow-y: auto;
        }
        .presentation-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .floating-animation {
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        .badge-new {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body>
    <!-- Header Principal -->
    <header class="bg-white shadow-lg sticky top-0 z-40">
        <div class="container mx-auto px-4 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-presentation-screen text-white text-xl"></i>
                    </div>
                    <div>
                        <h1 class="title-font text-2xl font-bold text-gray-800">Presentaciones Gaby</h1>
                        <p class="text-sm text-gray-600">Acceso P√∫blico</p>
                    </div>
                </div>
                <div class="text-right">
                    <p class="title-font text-lg text-purple-600 font-semibold">Gabriela Fernanda Huiscaleo Bugue√±o</p>
                    <p class="text-sm text-gray-500">Colegio Fines Relmu</p>
                </div>
            </div>
        </div>
    </header>

    <!-- Contenido Principal -->
    <main class="container mx-auto px-4 py-8">
        <!-- Banner de Bienvenida -->
        <div class="bg-white rounded-2xl shadow-xl p-8 mb-8 text-center border-4 border-yellow-300">
            <div class="floating-animation inline-block mb-4">
                <i class="fas fa-star text-yellow-500 presentation-icon"></i>
            </div>
            <h2 class="title-font text-4xl font-bold text-gray-800 mb-4">¬°Bienvenidos a mis Presentaciones!</h2>
            <p class="text-xl text-gray-600 mb-4">Aqu√≠ encontrar√°s todas mis presentaciones educativas interactivas</p>
            <div class="flex justify-center space-x-4 text-sm text-gray-500">
                <span><i class="fas fa-eye mr-1"></i>Visualizaci√≥n</span>
                <span><i class="fas fa-mobile-alt mr-1"></i>Responsive</span>
                <span><i class="fas fa-heart mr-1"></i>Educativo</span>
            </div>
        </div>

        <!-- Grid de Presentaciones -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="presentations-grid">
            <!-- Presentaci√≥n 1: Historia del Celular -->
            <div class="presentation-card bg-white rounded-xl shadow-lg overflow-hidden border-2 border-blue-200" onclick="openPresentation('historia-celular')">
                <div class="bg-gradient-to-br from-blue-400 to-purple-500 p-6 text-center text-white">
                    <i class="fas fa-mobile-alt presentation-icon"></i>
                    <h3 class="title-font text-xl font-bold mb-2">La Historia del Celular</h3>
                    <span class="badge-new bg-yellow-400 text-yellow-900 px-3 py-1 rounded-full text-xs font-bold">¬°NUEVO!</span>
                </div>
                <div class="p-6">
                    <p class="text-gray-600 mb-4">Un viaje interactivo desde 1983 hasta hoy. Descubre c√≥mo han evolucionado los tel√©fonos m√≥viles.</p>
                    <div class="flex justify-between items-center text-sm text-gray-500">
                        <span><i class="fas fa-clock mr-1"></i>5-10 min</span>
                        <span><i class="fas fa-users mr-1"></i>Todas las edades</span>
                    </div>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">Tecnolog√≠a</span>
                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">Historia</span>
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Interactivo</span>
                    </div>
                </div>
            </div>

            <!-- Presentaci√≥n 2: Placeholder para futuras presentaciones -->
            <div class="presentation-card bg-white rounded-xl shadow-lg overflow-hidden border-2 border-green-200 opacity-75" onclick="showComingSoon()">
                <div class="bg-gradient-to-br from-green-400 to-teal-500 p-6 text-center text-white">
                    <i class="fas fa-leaf presentation-icon"></i>
                    <h3 class="title-font text-xl font-bold mb-2">Ciencias Naturales</h3>
                    <span class="bg-orange-400 text-orange-900 px-3 py-1 rounded-full text-xs font-bold">PR√ìXIMAMENTE</span>
                </div>
                <div class="p-6">
                    <p class="text-gray-600 mb-4">Explora el mundo natural con presentaciones interactivas sobre plantas, animales y ecosistemas.</p>
                    <div class="flex justify-between items-center text-sm text-gray-500">
                        <span><i class="fas fa-clock mr-1"></i>Por determinar</span>
                        <span><i class="fas fa-users mr-1"></i>Primaria</span>
                    </div>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs">Ciencias</span>
                        <span class="bg-blue-100 text-blue-800 px-2 py-1 rounded-full text-xs">Naturaleza</span>
                    </div>
                </div>
            </div>

            <!-- Presentaci√≥n 3: Placeholder -->
            <div class="presentation-card bg-white rounded-xl shadow-lg overflow-hidden border-2 border-pink-200 opacity-75" onclick="showComingSoon()">
                <div class="bg-gradient-to-br from-pink-400 to-red-500 p-6 text-center text-white">
                    <i class="fas fa-book presentation-icon"></i>
                    <h3 class="title-font text-xl font-bold mb-2">Literatura</h3>
                    <span class="bg-orange-400 text-orange-900 px-3 py-1 rounded-full text-xs font-bold">PR√ìXIMAMENTE</span>
                </div>
                <div class="p-6">
                    <p class="text-gray-600 mb-4">Cuentos interactivos y an√°lisis literario para fomentar el amor por la lectura.</p>
                    <div class="flex justify-between items-center text-sm text-gray-500">
                        <span><i class="fas fa-clock mr-1"></i>Por determinar</span>
                        <span><i class="fas fa-users mr-1"></i>Todas las edades</span>
                    </div>
                    <div class="mt-4 flex flex-wrap gap-2">
                        <span class="bg-pink-100 text-pink-800 px-2 py-1 rounded-full text-xs">Literatura</span>
                        <span class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs">Cuentos</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estad√≠sticas de la p√°gina -->
        <div class="mt-12 bg-white rounded-xl shadow-lg p-6 border-2 border-gray-200">
            <h3 class="title-font text-2xl font-bold text-gray-800 mb-6 text-center">üìä Estad√≠sticas en Tiempo Real</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600" id="contador-disponibles">1</div>
                    <div class="text-sm text-gray-600">Disponibles</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600" id="contador-vistas">0</div>
                    <div class="text-sm text-gray-600">Total Vistas</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-purple-600">100%</div>
                    <div class="text-sm text-gray-600">Interactivas</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-pink-600">0</div>
                    <div class="text-sm text-gray-600">Costo</div>
                </div>
            </div>
            <div class="mt-6 bg-gray-50 rounded-lg p-4">
                <div class="text-center mb-3">
                    <span class="text-sm text-gray-500">üìà Presentaci√≥n m√°s vista: </span>
                    <span class="text-lg font-bold text-gray-800" id="popularidad">Historia del Celular</span>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-sm">
                    <div class="flex justify-between">
                        <span>üì± Historia del Celular:</span>
                        <span class="font-bold text-blue-600" id="vistas-historia">0 vistas</span>
                    </div>
                    <div class="flex justify-between opacity-50">
                        <span>üåø Ciencias Naturales:</span>
                        <span class="font-bold text-green-600" id="vistas-ciencias">0 vistas</span>
                    </div>
                    <div class="flex justify-between opacity-50">
                        <span>üìö Literatura:</span>
                        <span class="font-bold text-pink-600" id="vistas-literatura">0 vistas</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Secci√≥n YouTube-style: Suscr√≠bete y Likes -->
        <div class="mt-8 bg-white rounded-xl shadow-lg p-6 border-2 border-red-200">
            <div class="flex flex-col md:flex-row items-center justify-between space-y-4 md:space-y-0">
                <!-- Canal Info -->
                <div class="flex items-center space-x-4">
                    <div class="w-16 h-16 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full flex items-center justify-center">
                        <i class="fas fa-graduation-cap text-white text-2xl"></i>
                    </div>
                    <div>
                        <h4 class="title-font text-xl font-bold text-gray-800">Presentaciones Gaby</h4>
                        <p class="text-sm text-gray-600">Canal Educativo ‚Ä¢ <span id="suscriptores-count">1,337</span> suscriptores</p>
                        <p class="text-xs text-gray-500">Contenido educativo para primaria</p>
                    </div>
                </div>

                <!-- Bot√≥n Suscribirse -->
                <div class="flex items-center space-x-3">
                    <button 
                        id="btn-suscribirse" 
                        onclick="toggleSuscripcion()"
                        class="suscribir-btn bg-red-600 hover:bg-red-700 text-white px-6 py-2 rounded-full font-semibold transition-all duration-300 flex items-center space-x-2">
                        <i class="fas fa-bell" id="icon-suscripcion"></i>
                        <span id="texto-suscripcion">SUSCRIBIRSE</span>
                    </button>
                </div>
            </div>

            <!-- Barra de acciones tipo YouTube -->
            <div class="mt-6 flex flex-wrap items-center justify-between border-t pt-4">
                <!-- Likes y acciones -->
                <div class="flex items-center space-x-3">
                    <button 
                        id="btn-like-historia" 
                        onclick="toggleLike('historia-celular')"
                        class="like-btn flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-full transition-all duration-300">
                        <i class="far fa-thumbs-up" id="icon-like-historia"></i>
                        <span id="count-like-historia">0</span>
                    </button>
                    
                    <button 
                        onclick="compartirPresentacion('historia-celular', 'copy_link')"
                        class="flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-full transition-all duration-300">
                        <i class="fas fa-share"></i>
                        <span>Compartir</span>
                    </button>
                    
                    <button 
                        onclick="descargarPresentacion('historia-celular')"
                        class="flex items-center space-x-2 bg-gray-100 hover:bg-gray-200 px-4 py-2 rounded-full transition-all duration-300">
                        <i class="fas fa-download"></i>
                        <span>Descargar</span>
                    </button>
                </div>

                <!-- Stats r√°pidas -->
                <div class="flex items-center space-x-4 text-sm text-gray-600">
                    <span><i class="fas fa-eye mr-1"></i><span id="vistas-rapidas">0</span> vistas</span>
                    <span><i class="fas fa-calendar mr-1"></i>12 jun 2025</span>
                </div>
            </div>
        </div>
    </main>

    <!-- Modal para Presentaciones -->
    <div id="presentation-modal" class="fixed inset-0 modal-backdrop z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="modal-content bg-white rounded-2xl shadow-2xl w-full max-w-6xl relative">
                <!-- Header del Modal -->
                <div class="flex justify-between items-center p-4 border-b">
                    <h3 id="modal-title" class="title-font text-2xl font-bold text-gray-800"></h3>
                    <button onclick="closePresentation()" class="text-gray-500 hover:text-gray-700 text-2xl">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <!-- Contenido del Modal -->
                <div id="modal-content" class="p-0">
                    <!-- Aqu√≠ se cargar√° el iframe de la presentaci√≥n -->
                </div>
                
                <!-- Footer del Modal -->
                <div class="flex justify-between items-center p-4 border-t bg-gray-50">
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-info-circle mr-1"></i>
                        Presentaci√≥n creada por Gabriela Fernanda Huiscaleo Bugue√±o
                    </div>
                    <button onclick="closePresentation()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">
                        Cerrar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white shadow-lg mt-12">
        <div class="container mx-auto px-4 py-6">
            <div class="text-center">
                <p class="text-gray-600 mb-2">¬© 2024 Presentaciones Gaby - Colegio Fines Relmu</p>
                <div class="flex justify-center space-x-4 text-sm text-gray-500">
                    <span><i class="fas fa-graduation-cap mr-1"></i>Educativo</span>
                    <span><i class="fas fa-globe mr-1"></i>Acceso P√∫blico</span>
                    <span><i class="fas fa-mobile-alt mr-1"></i>Responsive</span>
                </div>
            </div>
        </div>
    </footer>

    <script src="js/config-service.js"></script>
    <script src="js/real-analytics-service.js"></script>
    <script>
        // üîß SISTEMA DE ANALYTICS REALES
        console.log('üåç Iniciando sistema de analytics reales...');
        
        // Verificar si el servicio de analytics reales se carg√≥
        setTimeout(() => {
            if (window.RealAnalyticsService) {
                console.log('‚úÖ RealAnalyticsService cargado - capturando visitantes reales');
                console.log('üìä Datos del visitante actual:', window.RealAnalyticsService.visitorData);
            } else {
                console.warn('‚ùå RealAnalyticsService NO se carg√≥ - usando fallback');
            }
        }, 2000); // Aumentar tiempo para que ConfigService se cargue primero

        // Funci√≥n para obtener estad√≠sticas reales
        async function obtenerEstadisticasVisualizaciones() {
            if (window.RealAnalyticsService) {
                // Usar analytics reales
                const estadisticasReales = await window.RealAnalyticsService.obtenerEstadisticasReales();
                
                // Convertir al formato esperado
                const resultado = {
                    'historia-celular': 0,
                    'ciencias-naturales': 0,
                    'literatura': 0,
                    total: 0,
                    isOnline: window.RealAnalyticsService.isOnline,
                    realData: estadisticasReales
                };

                // Mapear datos reales
                estadisticasReales.forEach(stat => {
                    if (resultado[stat.presentacion_id] !== undefined) {
                        resultado[stat.presentacion_id] = stat.total_visualizaciones;
                    }
                });

                resultado.total = resultado['historia-celular'] + 
                               resultado['ciencias-naturales'] + 
                               resultado['literatura'];

                return resultado;
            } else {
                // Fallback: solo LocalStorage
                const estadisticas = JSON.parse(localStorage.getItem('gaby-presentaciones-stats') || '{}');
                return {
                    'historia-celular': estadisticas['historia-celular'] || 0,
                    'ciencias-naturales': estadisticas['ciencias-naturales'] || 0,
                    'literatura': estadisticas['literatura'] || 0,
                    total: Object.values(estadisticas).reduce((sum, val) => sum + val, 0),
                    isOnline: false
                };
            }
        }

        // Funci√≥n para registrar visualizaci√≥n REAL
        async function incrementarVisualizacion(presentacionId, titulo) {
            console.log(`üé¨ Registrando visitante REAL para: ${presentacionId}`);
            
            if (window.RealAnalyticsService) {
                // Usar analytics reales - captura IP, ubicaci√≥n, etc.
                await window.RealAnalyticsService.registrarVisualizacionReal(presentacionId, titulo);
            } else {
                // Fallback: solo LocalStorage
                const estadisticas = JSON.parse(localStorage.getItem('gaby-presentaciones-stats') || '{}');
                estadisticas[presentacionId] = (estadisticas[presentacionId] || 0) + 1;
                localStorage.setItem('gaby-presentaciones-stats', JSON.stringify(estadisticas));
            }
            
            // Actualizar UI inmediatamente
            await actualizarEstadisticasUI();
        }

        // Funci√≥n para actualizar UI de estad√≠sticas (mejorada para datos reales)
        async function actualizarEstadisticasUI() {
            const stats = await obtenerEstadisticasVisualizaciones();
            
            // Actualizar contador total de vistas
            const contadorVistas = document.getElementById('contador-vistas');
            if (contadorVistas) {
                contadorVistas.textContent = stats.total;
                
                // A√±adir indicador de datos reales
                const estadoIndicador = contadorVistas.parentElement.querySelector('.estado-indicator');
                if (estadoIndicador) {
                    estadoIndicador.remove();
                }
                
                const indicator = document.createElement('div');
                indicator.className = 'estado-indicator text-xs mt-1';
                
                if (window.RealAnalyticsService) {
                    const visitorData = window.RealAnalyticsService.visitorData;
                    const ipInfo = visitorData?.ip?.ip || 'Obteniendo...';
                    indicator.innerHTML = stats.isOnline 
                        ? `<span class="text-green-600">üåç Visitantes reales (IP: ${ipInfo})</span>`
                        : '<span class="text-orange-600">üì± Modo offline</span>';
                } else {
                    indicator.innerHTML = '<span class="text-gray-600">üíæ Solo local</span>';
                }
                
                contadorVistas.parentElement.appendChild(indicator);
            }

            // Actualizar contador de disponibles
            const contadorDisponibles = document.getElementById('contador-disponibles');
            if (contadorDisponibles) {
                const disponibles = (stats['historia-celular'] > 0 ? 1 : 0) + 
                                  (stats['ciencias-naturales'] > 0 ? 1 : 0) + 
                                  (stats['literatura'] > 0 ? 1 : 0);
                contadorDisponibles.textContent = disponibles;
            }

            // Actualizar popularidad (m√°s visto)
            const popularidad = document.getElementById('popularidad');
            if (popularidad) {
                let masPopular = 'Historia del Celular';
                let maxVistas = stats['historia-celular'];
                
                if (stats['ciencias-naturales'] > maxVistas) {
                    masPopular = 'Ciencias Naturales';
                    maxVistas = stats['ciencias-naturales'];
                }
                if (stats['literatura'] > maxVistas) {
                    masPopular = 'Literatura';
                }
                
                popularidad.textContent = masPopular;
            }

            // Actualizar vistas por presentaci√≥n con animaci√≥n
            const actualizarContador = (elementId, valor) => {
                const elemento = document.getElementById(elementId);
                if (elemento) {
                    const valorAnterior = parseInt(elemento.textContent) || 0;
                    elemento.textContent = valor + ' vistas';
                    
                    // Animaci√≥n si hay cambio
                    if (valor > valorAnterior) {
                        elemento.parentElement.classList.add('bg-green-100');
                        elemento.classList.add('font-bold', 'text-green-700');
                        setTimeout(() => {
                            elemento.parentElement.classList.remove('bg-green-100');
                            elemento.classList.remove('font-bold', 'text-green-700');
                        }, 2000);
                    }
                }
            };

            actualizarContador('vistas-historia', stats['historia-celular']);
            actualizarContador('vistas-ciencias', stats['ciencias-naturales']);
            actualizarContador('vistas-literatura', stats['literatura']);

            // Mostrar estad√≠sticas online adicionales si est√°n disponibles
            if (stats.online && stats.online.length > 0) {
                mostrarEstadisticasAdicionales(stats.online);
            }

            // Mostrar informaci√≥n adicional de visitantes reales
            if (stats.realData && stats.realData.length > 0) {
                mostrarDatosVisitantesReales(stats.realData);
            }
        }

        // Mostrar estad√≠sticas adicionales cuando hay datos online
        function mostrarEstadisticasAdicionales(estadisticasOnline) {
            let infoAdicional = document.getElementById('info-adicional-stats');
            if (!infoAdicional) {
                infoAdicional = document.createElement('div');
                infoAdicional.id = 'info-adicional-stats';
                infoAdicional.className = 'mt-4 p-3 bg-blue-50 rounded-lg border border-blue-200';
                
                const statsContainer = document.querySelector('.mt-12.bg-white.rounded-xl');
                if (statsContainer) {
                    statsContainer.appendChild(infoAdicional);
                }
            }

            const totalOnline = estadisticasOnline.reduce((sum, stat) => sum + stat.total_visualizaciones, 0);
            const ultimaVisualizacion = estadisticasOnline
                .map(stat => new Date(stat.ultima_visualizacion))
                .reduce((latest, date) => date > latest ? date : latest, new Date(0));

            infoAdicional.innerHTML = `
                <div class="text-center">
                    <h4 class="font-bold text-blue-800 mb-2">üìä Estad√≠sticas Globales Online</h4>
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-blue-600 font-semibold">${totalOnline}</span>
                            <br><span class="text-gray-600">Vistas totales globales</span>
                        </div>
                        <div>
                            <span class="text-blue-600 font-semibold">${ultimaVisualizacion.toLocaleDateString()}</span>
                            <br><span class="text-gray-600">√öltima visualizaci√≥n</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Mostrar informaci√≥n de visitantes reales
        function mostrarDatosVisitantesReales(datosReales) {
            let infoReales = document.getElementById('info-visitantes-reales');
            if (!infoReales) {
                infoReales = document.createElement('div');
                infoReales.id = 'info-visitantes-reales';
                infoReales.className = 'mt-4 p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-lg border-2 border-blue-200';
                
                const statsContainer = document.querySelector('.mt-12.bg-white.rounded-xl');
                if (statsContainer) {
                    statsContainer.appendChild(infoReales);
                }
            }

            const totalVisitantes = datosReales.reduce((sum, stat) => sum + stat.total_visualizaciones, 0);
            
            // Obtener datos del visitante actual de forma m√°s robusta
            const visitorData = window.RealAnalyticsService?.visitorData;
            const paisActual = visitorData?.ip?.country || 'Detectando...';
            const ciudadActual = visitorData?.ip?.city || 'Detectando...';
            const regionActual = visitorData?.ip?.region || 'Detectando...';
            const dispositivoActual = visitorData?.deviceType || 'Detectando...';
            const navegadorActual = visitorData?.browserInfo?.browser || 'Detectando...';
            const ipActual = visitorData?.ip?.ip || 'Detectando...';
            
            infoReales.innerHTML = `
                <div class="text-center">
                    <h4 class="font-bold text-blue-800 mb-3">üåç Analytics de Visitantes Reales</h4>
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 text-sm mb-4">
                        <div class="bg-white p-3 rounded-lg shadow">
                            <div class="text-xl font-bold text-blue-600">${totalVisitantes}</div>
                            <div class="text-gray-600">Visitantes √∫nicos</div>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow">
                            <div class="text-xl font-bold text-green-600">${paisActual}</div>
                            <div class="text-gray-600">Pa√≠s</div>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow">
                            <div class="text-xl font-bold text-purple-600">${ciudadActual}</div>
                            <div class="text-gray-600">Ciudad</div>
                        </div>
                        <div class="bg-white p-3 rounded-lg shadow">
                            <div class="text-xl font-bold text-orange-600">${dispositivoActual}</div>
                            <div class="text-gray-600">Dispositivo</div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-2 text-xs text-gray-600 bg-white p-3 rounded-lg">
                        <div><strong>üåç Regi√≥n:</strong> ${regionActual}</div>
                        <div><strong>üåê IP:</strong> ${ipActual}</div>
                        <div><strong>üíª Navegador:</strong> ${navegadorActual}</div>
                    </div>
                    <div class="mt-3 text-xs text-green-600 font-semibold">
                        ‚úÖ Sistema capturando: IP real, geolocalizaci√≥n, tipo de dispositivo, navegador, ISP
                    </div>
                </div>
            `;
        }

        // FUNCIONES TIPO YOUTUBE: LIKES Y SUSCRIPCI√ìN

        // Funci√≥n para toggle de suscripci√≥n
        function toggleSuscripcion() {
            if (!window.RealAnalyticsService) {
                alert('üîß Servicio no disponible');
                return;
            }

            const btnSuscribirse = document.getElementById('btn-suscribirse');
            const iconSuscripcion = document.getElementById('icon-suscripcion');
            const textoSuscripcion = document.getElementById('texto-suscripcion');
            const suscriptoresCount = document.getElementById('suscriptores-count');

            const estaSuscrito = window.RealAnalyticsService.estaSuscrito();

            if (!estaSuscrito) {
                // Suscribirse
                window.RealAnalyticsService.registrarSuscripcion();
                
                // Actualizar UI
                btnSuscribirse.classList.remove('bg-red-600', 'hover:bg-red-700');
                btnSuscribirse.classList.add('bg-gray-600', 'hover:bg-gray-700');
                iconSuscripcion.classList.remove('fas', 'fa-bell');
                iconSuscripcion.classList.add('fas', 'fa-bell-slash');
                textoSuscripcion.textContent = 'SUSCRITO';
                
                // Incrementar contador de suscriptores
                const currentCount = parseInt(suscriptoresCount.textContent.replace(/,/g, ''));
                suscriptoresCount.textContent = (currentCount + 1).toLocaleString();
                
                // Animaci√≥n de √©xito
                btnSuscribirse.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    btnSuscribirse.style.transform = 'scale(1)';
                }, 200);
                
                // Mostrar notificaci√≥n
                mostrarNotificacion('üîî ¬°Te has suscrito a Presentaciones Gaby!', 'success');
                
            } else {
                // Desuscribirse
                localStorage.removeItem('gaby-suscripcion');
                
                // Actualizar UI
                btnSuscribirse.classList.remove('bg-gray-600', 'hover:bg-gray-700');
                btnSuscribirse.classList.add('bg-red-600', 'hover:bg-red-700');
                iconSuscripcion.classList.remove('fas', 'fa-bell-slash');
                iconSuscripcion.classList.add('fas', 'fa-bell');
                textoSuscripcion.textContent = 'SUSCRIBIRSE';
                
                // Decrementar contador de suscriptores
                const currentCount = parseInt(suscriptoresCount.textContent.replace(/,/g, ''));
                suscriptoresCount.textContent = Math.max(1337, currentCount - 1).toLocaleString();
                
                mostrarNotificacion('üò¢ Te has desuscrito de Presentaciones Gaby', 'info');
            }
        }

        // Funci√≥n para toggle de like
        async function toggleLike(presentacionId) {
            if (!window.RealAnalyticsService) {
                mostrarNotificacion('üîß Servicio no disponible', 'error');
                return;
            }

            // Mapear presentacion_id a elementos espec√≠ficos del DOM
            let elementSuffix;
            switch(presentacionId) {
                case 'historia-celular':
                    elementSuffix = 'historia';
                    break;
                case 'ciencias-naturales':
                    elementSuffix = 'ciencias';
                    break;
                case 'literatura':
                    elementSuffix = 'literatura';
                    break;
                default:
                    console.warn('Presentaci√≥n no reconocida:', presentacionId);
                    return;
            }

            const btnLike = document.getElementById(`btn-like-${elementSuffix}`);
            const iconLike = document.getElementById(`icon-like-${elementSuffix}`);
            const countLike = document.getElementById(`count-like-${elementSuffix}`);

            // Verificar que los elementos existen
            if (!btnLike || !iconLike || !countLike) {
                console.warn('Elementos de like no encontrados para:', elementSuffix);
                mostrarNotificacion('Error: Elementos de interfaz no encontrados', 'error');
                return;
            }

            // CORREGIDO: Obtener likes de forma segura para evitar NaN
            const likesData = window.RealAnalyticsService.obtenerLikes(presentacionId);
            console.log('üìä Datos de likes obtenidos:', likesData);
            
            // Asegurar valores num√©ricos v√°lidos
            const currentTotal = parseInt(likesData.total) || 0;
            const yaLeDioLike = likesData.userLiked === true;

            try {
                if (!yaLeDioLike) {
                    // Dar like
                    await window.RealAnalyticsService.registrarLike(presentacionId, 'like');
                    
                    // Actualizar UI con valor seguro
                    iconLike.classList.remove('far');
                    iconLike.classList.add('fas', 'text-blue-600');
                    btnLike.classList.add('bg-blue-100', 'border-blue-300');
                    
                    // Animaci√≥n del like
                    iconLike.style.transform = 'scale(1.3)';
                    iconLike.style.color = '#3B82F6';
                    setTimeout(() => {
                        iconLike.style.transform = 'scale(1)';
                    }, 300);
                    
                    // CORREGIDO: Actualizar contador de forma segura
                    const newCount = currentTotal + 1;
                    countLike.textContent = newCount;
                    countLike.style.color = '#3B82F6';
                    countLike.style.fontWeight = 'bold';
                    
                    // NUEVO: Mensaje de agradecimiento personalizado
                    mostrarNotificacion('Gracias ‚ù§Ô∏è', 'success');
                    
                } else {
                    // Quitar like
                    await window.RealAnalyticsService.registrarLike(presentacionId, 'unlike');
                    
                    // Actualizar UI
                    iconLike.classList.remove('fas', 'text-blue-600');
                    iconLike.classList.add('far');
                    btnLike.classList.remove('bg-blue-100', 'border-blue-300');
                    
                    // CORREGIDO: Actualizar contador de forma segura
                    const newCount = Math.max(0, currentTotal - 1);
                    countLike.textContent = newCount;
                    countLike.style.color = '';
                    countLike.style.fontWeight = '';
                    
                    mostrarNotificacion('üëé Like removido', 'info');
                }

                // Actualizar las estad√≠sticas generales
                await actualizarEstadisticasUI();
                
            } catch (error) {
                console.error('Error en toggleLike:', error);
                mostrarNotificacion('Error al procesar like', 'error');
            }
        }

        // Funci√≥n para compartir presentaci√≥n (NUEVA)
        async function compartirPresentacion(presentacionId, tipoCompartir = 'copy_link') {
            if (!window.RealAnalyticsService) {
                mostrarNotificacion('üîß Servicio no disponible', 'error');
                return;
            }

            try {
                // Registrar el compartir
                await window.RealAnalyticsService.registrarCompartir(presentacionId, tipoCompartir);
                
                const urlPresentacion = `${window.location.origin}/${presentacionId}.html`;
                
                switch(tipoCompartir) {
                    case 'copy_link':
                        // Copiar al portapapeles
                        if (navigator.clipboard) {
                            await navigator.clipboard.writeText(urlPresentacion);
                            mostrarNotificacion('üîó ¬°Link copiado al portapapeles!', 'success');
                        } else {
                            // Fallback para navegadores antiguos
                            const textArea = document.createElement('textarea');
                            textArea.value = urlPresentacion;
                            document.body.appendChild(textArea);
                            textArea.select();
                            document.execCommand('copy');
                            document.body.removeChild(textArea);
                            mostrarNotificacion('üîó ¬°Link copiado al portapapeles!', 'success');
                        }
                        break;
                        
                    case 'whatsapp':
                        const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(`¬°Mira esta presentaci√≥n educativa! ${urlPresentacion}`)}`;
                        window.open(whatsappUrl, '_blank');
                        mostrarNotificacion('üì± Compartiendo en WhatsApp', 'info');
                        break;
                        
                    case 'facebook':
                        const facebookUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(urlPresentacion)}`;
                        window.open(facebookUrl, '_blank', 'width=600,height=400');
                        mostrarNotificacion('üìò Compartiendo en Facebook', 'info');
                        break;
                        
                    case 'twitter':
                        const twitterUrl = `https://twitter.com/intent/tweet?url=${encodeURIComponent(urlPresentacion)}&text=${encodeURIComponent('¬°Mira esta presentaci√≥n educativa!')}`;
                        window.open(twitterUrl, '_blank', 'width=600,height=400');
                        mostrarNotificacion('üê¶ Compartiendo en Twitter', 'info');
                        break;
                        
                    case 'email':
                        const emailUrl = `mailto:?subject=${encodeURIComponent('Presentaci√≥n Educativa')}&body=${encodeURIComponent(`Te comparto esta presentaci√≥n: ${urlPresentacion}`)}`;
                        window.location.href = emailUrl;
                        mostrarNotificacion('üìß Abriendo cliente de email', 'info');
                        break;
                }
                
                // Actualizar estad√≠sticas
                await actualizarEstadisticasUI();
                
            } catch (error) {
                console.error('Error compartiendo:', error);
                mostrarNotificacion('‚ùå Error al compartir', 'error');
            }
        }

        // Funci√≥n para descargar presentaci√≥n (NUEVA)
        async function descargarPresentacion(presentacionId) {
            if (!window.RealAnalyticsService) {
                mostrarNotificacion('üîß Servicio no disponible', 'error');
                return;
            }

            try {
                // Registrar la descarga como compartir tipo 'download'
                await window.RealAnalyticsService.registrarCompartir(presentacionId, 'download');
                
                // Abrir presentaci√≥n en nueva pesta√±a
                window.open(`${presentacionId}.html`, '_blank');
                mostrarNotificacion('üì± Presentaci√≥n abierta en nueva pesta√±a', 'success');
                
                // Actualizar estad√≠sticas
                await actualizarEstadisticasUI();
                
            } catch (error) {
                console.error('Error descargando:', error);
                mostrarNotificacion('‚ùå Error al descargar', 'error');
            }
        }

        // Mostrar men√∫ de descarga (NUEVA)
        function mostrarMenuDescarga(opciones) {
            return new Promise((resolve) => {
                const modal = document.createElement('div');
                modal.className = 'fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
                
                modal.innerHTML = `
                    <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                        <h3 class="text-lg font-bold mb-4 text-center">üì• Opciones de Descarga</h3>
                        <div class="space-y-2">
                            ${opciones.map((opcion, index) => `
                                <button 
                                    onclick="selectOption(${index})"
                                    class="w-full p-3 text-left bg-gray-50 hover:bg-blue-50 rounded-lg transition-colors border border-gray-200 hover:border-blue-300">
                                    ${opcion}
                                </button>
                            `).join('')}
                        </div>
                        <button 
                            onclick="closeModal()"
                            class="w-full mt-4 p-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600">
                            Cancelar
                        </button>
                    </div>
                `;
                
                // Funciones del modal
                window.selectOption = (index) => {
                    document.body.removeChild(modal);
                    delete window.selectOption;
                    delete window.closeModal;
                    resolve(index);
                };
                
                window.closeModal = () => {
                    document.body.removeChild(modal);
                    delete window.selectOption;
                    delete window.closeModal;
                    resolve(-1); // Cancelado
                };
                
                document.body.appendChild(modal);
            });
        }

        // Actualizar funci√≥n de contadores YouTube para incluir compartidos
        function actualizarContadoresYoutube() {
            if (!window.RealAnalyticsService) return;

            // Actualizar estado de suscripci√≥n
            const estaSuscrito = window.RealAnalyticsService.estaSuscrito();
            const btnSuscribirse = document.getElementById('btn-suscribirse');
            const iconSuscripcion = document.getElementById('icon-suscripcion');
            const textoSuscripcion = document.getElementById('texto-suscripcion');

            if (estaSuscrito) {
                btnSuscribirse.classList.remove('bg-red-600', 'hover:bg-red-700');
                btnSuscribirse.classList.add('bg-gray-600', 'hover:bg-gray-700');
                iconSuscripcion.classList.remove('fas', 'fa-bell');
                iconSuscripcion.classList.add('fas', 'fa-bell-slash');
                textoSuscribirse.textContent = 'SUSCRITO';
            }

            // Actualizar likes de Historia del Celular
            const likesHistoria = window.RealAnalyticsService.obtenerLikes('historia-celular');
            const countLikeHistoria = document.getElementById('count-like-historia');
            const iconLikeHistoria = document.getElementById('icon-like-historia');
            const btnLikeHistoria = document.getElementById('btn-like-historia');

            if (countLikeHistoria) {
                countLikeHistoria.textContent = likesHistoria.total;
                
                if (likesHistoria.userLiked) {
                    iconLikeHistoria.classList.remove('far');
                    iconLikeHistoria.classList.add('fas', 'text-blue-600');
                    btnLikeHistoria.classList.add('bg-blue-100', 'border-blue-300');
                    countLikeHistoria.style.color = '#3B82F6';
                    countLikeHistoria.style.fontWeight = 'bold';
                }
            }

            // Actualizar vistas r√°pidas
            const vistasRapidas = document.getElementById('vistas-rapidas');
            if (vistasRapidas) {
                const stats = JSON.parse(localStorage.getItem('gaby-presentaciones-stats') || '{}');
                const totalVistas = Object.values(stats).reduce((sum, val) => sum + val, 0);
                vistasRapidas.textContent = totalVistas.toLocaleString();
            }

            // Mostrar estad√≠sticas de compartidos si existen
            const compartidos = JSON.parse(localStorage.getItem('gaby-compartidos') || '{}');
            if (Object.keys(compartidos).length > 0) {
                const totalCompartidos = Object.values(compartidos).reduce((sum, c) => sum + c.total, 0);
                const statsCompartidos = document.getElementById('stats-compartidos');
                if (!statsCompartidos) {
                    const statsRapidas = document.querySelector('.flex.items-center.space-x-4.text-sm.text-gray-600');
                    if (statsRapidas) {
                        const compartidosSpan = document.createElement('span');
                        compartidosSpan.id = 'stats-compartidos';
                        compartidosSpan.innerHTML = `<i class="fas fa-share mr-1"></i><span>${totalCompartidos}</span> compartidos`;
                        statsRapidas.appendChild(compartidosSpan);
                    }
                } else {
                    statsCompartidos.innerHTML = `<i class="fas fa-share mr-1"></i><span>${totalCompartidos}</span> compartidos`;
                }
            }
        }

        // Funci√≥n para abrir presentaci√≥n (actualizada)
        async function openPresentation(presentationId) {
            if (presentationId === 'historia-celular') {
                // Incrementar contador ANTES de abrir
                await incrementarVisualizacion(presentationId, 'La Historia del Celular');
                
                // Abrir en nueva ventana/pesta√±a el archivo HTML independiente
                window.open('historia-celular.html', '_blank');
                return;
            }
            
            // Para otras presentaciones futuras
            showComingSoon();
        }

        // Funci√≥n para cerrar presentaci√≥n
        function closePresentation() {
            const modal = document.getElementById('presentation-modal');
            modal.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // Funci√≥n para mostrar "pr√≥ximamente"
        function showComingSoon() {
            mostrarNotificacion('üöß Esta presentaci√≥n estar√° disponible pr√≥ximamente.\n\n‚ú® ¬°Mantente atento a las nuevas actualizaciones!', 'info');
        }

        // Cerrar modal al hacer clic fuera
        document.getElementById('presentation-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closePresentation();
            }
        });

        // Cerrar modal con tecla Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closePresentation();
            }
        });

        // Animaci√≥n de entrada para las tarjetas
        function mostrarPresentaciones() {
            const cards = document.querySelectorAll('.presentation-card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.transform = 'translateY(0)';
                    card.style.opacity = '1';
                }, index * 200);
            });
        }

        // Inicializar las tarjetas ocultas para la animaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.presentation-card');
            cards.forEach(card => {
                card.style.transform = 'translateY(20px)';
                card.style.opacity = '0';
                card.style.transition = 'all 0.5s ease';
            });
            
            // Mostrar las presentaciones con animaci√≥n
            setTimeout(() => {
                mostrarPresentaciones();
            }, 500);
            
            // Inicializar estad√≠sticas al cargar la p√°gina
            actualizarEstadisticasUI();
            
            // Inicializar contadores YouTube
            setTimeout(() => {
                actualizarContadoresYoutube();
            }, 1000);
        });

        // Funci√≥n para mostrar notificaciones estilo YouTube
        function mostrarNotificacion(mensaje, tipo = 'info') {
            const notificacion = document.createElement('div');
            notificacion.className = `fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300`;
            
            switch(tipo) {
                case 'success':
                    notificacion.classList.add('bg-green-500', 'text-white');
                    break;
                case 'error':
                    notificacion.classList.add('bg-red-500', 'text-white');
                    break;
                default:
                    notificacion.classList.add('bg-blue-500', 'text-white');
            }
            
            notificacion.innerHTML = `
                <div class="flex items-center space-x-2">
                    <span>${mensaje}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-2 hover:opacity-75">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notificacion);
            
            // Animaci√≥n de entrada
            setTimeout(() => {
                notificacion.classList.remove('translate-x-full');
            }, 100);
            
            // Auto-remover despu√©s de 4 segundos
            setTimeout(() => {
                notificacion.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notificacion.parentElement) {
                        notificacion.remove();
                    }
                }, 300);
            }, 4000);
        }
    </script>
</body>
</html>